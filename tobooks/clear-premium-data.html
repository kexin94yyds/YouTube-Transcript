<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…é›¶ä»˜è´¹ç”¨æˆ·æ•°æ®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        .btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f0f0f0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ æ¸…é›¶ä»˜è´¹ç”¨æˆ·æ•°æ®</h1>
        <p>è¿™ä¸ªå·¥å…·ç”¨äºæ¸…é™¤æ‰€æœ‰ä»˜è´¹ç”¨æˆ·ç›¸å…³çš„æ•°æ®ï¼Œæ–¹ä¾¿é‡æ–°æµ‹è¯•ä»˜è´¹æµç¨‹</p>
        
        <div class="status info">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong><br>
            æ­¤æ“ä½œå°†æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„ä»˜è´¹çŠ¶æ€å’Œæ•°æ®åº“ä¸­çš„ä»˜è´¹è®°å½•<br>
            è¯·ç¡®ä¿åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨
        </div>
        
        <div>
            <button class="btn" onclick="clearLocalStorage()">æ¸…é™¤æœ¬åœ°å­˜å‚¨</button>
            <button class="btn" onclick="clearDatabase()">æ¸…é™¤æ•°æ®åº“è®°å½•</button>
            <button class="btn" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        </div>
        
        <div id="result" class="status" style="display: none;"></div>
        
        <div style="margin-top: 30px; text-align: left;">
            <h3>ğŸ“‹ æ¸…é™¤å†…å®¹è¯´æ˜</h3>
            <ul>
                <li><strong>æœ¬åœ°å­˜å‚¨ï¼š</strong>isPremiumUser, whitelistUser, trialViewCount, userData ç­‰</li>
                <li><strong>æ•°æ®åº“ï¼š</strong>premium_users è¡¨ä¸­çš„æ‰€æœ‰è®°å½•</li>
                <li><strong>ä¼šè¯ï¼š</strong>Supabase ç™»å½•ä¼šè¯</li>
            </ul>
        </div>
    </div>

    <!-- å¼•å…¥ Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabaseClient.js"></script>
    
    <script>
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `status ${type}`;
            resultDiv.style.display = 'block';
        }
        
        function clearLocalStorage() {
            try {
                // æ¸…é™¤æ‰€æœ‰ç›¸å…³çš„æœ¬åœ°å­˜å‚¨
                const keysToRemove = [
                    'isPremiumUser',
                    'whitelistUser', 
                    'trialViewCount',
                    'userData',
                    'userEmail',
                    'userDisplayName',
                    'userAvatar',
                    'pendingPremiumSync'
                ];
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                showResult('âœ… æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤ï¼\n\nå·²æ¸…é™¤çš„é”®ï¼š' + keysToRemove.join(', '), 'success');
                
            } catch (error) {
                showResult(`âŒ æ¸…é™¤æœ¬åœ°å­˜å‚¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function clearDatabase() {
            try {
                showResult('æ­£åœ¨æ¸…é™¤æ•°æ®åº“è®°å½•...', 'info');
                
                const supabase = window.supabaseClient?.getClient();
                if (!supabase) {
                    throw new Error('Supabase å®¢æˆ·ç«¯æœªåˆå§‹åŒ–');
                }
                
                // åˆ é™¤ premium_users è¡¨ä¸­çš„æ‰€æœ‰è®°å½•
                const { error } = await supabase
                    .from('premium_users')
                    .delete()
                    .neq('id', 0); // åˆ é™¤æ‰€æœ‰è®°å½•
                
                if (error) {
                    throw error;
                }
                
                showResult('âœ… æ•°æ®åº“è®°å½•å·²æ¸…é™¤ï¼\n\nå·²åˆ é™¤ premium_users è¡¨ä¸­çš„æ‰€æœ‰è®°å½•', 'success');
                
            } catch (error) {
                showResult(`âŒ æ¸…é™¤æ•°æ®åº“å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function clearAll() {
            try {
                showResult('æ­£åœ¨æ¸…é™¤æ‰€æœ‰æ•°æ®...', 'info');
                
                // 1. æ¸…é™¤æœ¬åœ°å­˜å‚¨
                clearLocalStorage();
                
                // 2. æ¸…é™¤æ•°æ®åº“
                await clearDatabase();
                
                // 3. é€€å‡ºç™»å½•
                const supabase = window.supabaseClient?.getClient();
                if (supabase) {
                    await supabase.auth.signOut();
                }
                
                showResult('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼\n\nåŒ…æ‹¬ï¼šæœ¬åœ°å­˜å‚¨ã€æ•°æ®åº“è®°å½•ã€ç™»å½•ä¼šè¯', 'success');
                
                // 3ç§’ååˆ·æ–°é¡µé¢
                setTimeout(() => {
                    if (confirm('æ•°æ®å·²æ¸…é™¤å®Œæˆï¼Œæ˜¯å¦åˆ·æ–°é¡µé¢ï¼Ÿ')) {
                        location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                showResult(`âŒ æ¸…é™¤æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
        document.addEventListener('DOMContentLoaded', () => {
            const isPremium = localStorage.getItem('isPremiumUser') === 'true';
            const isWhitelist = localStorage.getItem('whitelistUser') === 'true';
            const trialCount = localStorage.getItem('trialViewCount') || '0';
            
            showResult(`å½“å‰çŠ¶æ€ï¼š\nä»˜è´¹ç”¨æˆ·: ${isPremium ? 'æ˜¯' : 'å¦'}\nç™½åå•ç”¨æˆ·: ${isWhitelist ? 'æ˜¯' : 'å¦'}\nè¯•ç”¨æ¬¡æ•°: ${trialCount}`, 'info');
        });
    </script>
</body>
</html>
