# 🎓 白名单管理系统使用说明

## 📝 概述

白名单管理系统让你可以轻松管理付费用户和免费学员的访问权限。

## 🔐 访问管理界面

### URL
```
http://localhost:3001/admin.html
或
https://你的域名/admin.html
```

### 登录密码
```
kx94yyds2024
```

**⚠️ 重要提示：** 建议在部署到生产环境前修改密码。在 `admin.html` 文件中搜索 `ADMIN_PASSWORD` 并修改。

## 🎯 主要功能

### 1. 查看统计信息
- 总用户数
- 活跃用户数
- 白名单用户数

### 2. 添加白名单用户
填写以下信息：
- **学员邮箱**（必填）：学员注册时使用的邮箱
- **学员姓名**（可选）：方便识别
- **备注**（可选）：例如"2024春季班学员"

点击"添加到白名单"即可。

### 3. 管理现有用户
对于每个用户，你可以：
- **激活/停用**：控制用户访问权限
- **删除**：永久删除用户（不可恢复）

## 📋 使用流程

### 给学员授权的步骤

1. **登录管理界面**
   - 访问 `admin.html`
   - 输入管理员密码

2. **添加学员到白名单**
   - 输入学员的邮箱地址
   - 填写姓名和备注（可选）
   - 点击"添加到白名单"

3. **通知学员**
   - 告知学员使用该邮箱注册/登录
   - 学员登录后会自动获得完整访问权限

### 学员使用流程

1. 学员访问网站首页
2. 点击"登录"按钮
3. 使用你添加的邮箱注册/登录
4. 系统自动识别白名单，授予完整权限
5. 可以正常使用所有功能，无需支付

## 🔒 安全建议

### 1. 修改管理员密码
在 `admin.html` 中修改：
```javascript
const ADMIN_PASSWORD = '你的新密码';
```

### 2. 限制访问
考虑在服务器层面限制 `admin.html` 的访问，例如：
- IP 白名单
- VPN 访问
- 添加额外的身份验证

### 3. 定期审查
- 定期检查白名单用户列表
- 删除不再需要的用户
- 停用已过期的学员账号

## 💡 常见问题

### Q: 学员说登录后还是提示需要付费？
A: 
1. 确认学员使用的邮箱与白名单中的邮箱完全一致
2. 让学员退出登录后重新登录
3. 清除浏览器缓存和 localStorage

### Q: 如何批量添加学员？
A: 可以直接在 Supabase 后台使用 SQL 批量插入：
```sql
INSERT INTO premium_users (email, display_name, is_active, payment_status, site, notes)
VALUES 
  ('student1@example.com', '学员1', true, 'whitelist', 'tobooks', '2024春季班'),
  ('student2@example.com', '学员2', true, 'whitelist', 'tobooks', '2024春季班'),
  ('student3@example.com', '学员3', true, 'whitelist', 'tobooks', '2024春季班');
```

### Q: 白名单用户和付费用户有什么区别？
A: 没有区别！白名单用户拥有和付费用户完全相同的权限，只是获取权限的方式不同：
- 付费用户：通过微信支付购买
- 白名单用户：由管理员直接添加

### Q: 如何临时停用某个学员？
A: 在用户列表中点击该用户的"停用"按钮，需要恢复时再点击"激活"。

## 📊 数据库字段说明

在 Supabase 的 `premium_users` 表中：
- `email`: 用户邮箱（唯一标识）
- `display_name`: 显示名称
- `is_active`: 是否激活（true/false）
- `payment_status`: 支付状态（'paid', 'whitelist', 'free'）
- `site`: 站点标识（'tobooks', 'all'）
- `notes`: 备注信息
- `created_at`: 创建时间
- `updated_at`: 更新时间

## 🚀 部署建议

### 本地开发
```bash
# 启动服务器
node server.js
# 访问 http://localhost:3001/admin.html
```

### 生产环境
1. 确保 `admin.html` 已上传到服务器
2. 修改管理员密码
3. 考虑添加额外的访问限制
4. 定期备份 Supabase 数据库

## 📞 技术支持

如有问题，请检查：
1. Supabase 连接是否正常
2. `supabaseClient.js` 是否正确配置
3. 浏览器控制台是否有错误信息
